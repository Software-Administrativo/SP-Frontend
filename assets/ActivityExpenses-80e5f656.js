import{v as B,x as N,_ as Ae,f as Ee,y as Se,g as n,z as Ve,h as se,A as Ie,C as Ce,r as p,o as O,c as le,a as u,d as t,w as r,i,q as j,M as ze,l as ne,F as De,D as L,E as Q,j as I,m as G,t as Te,k as H,G as re,B as ie,p as Oe,e as Ge}from"./index-21ef78fb.js";import{B as Be}from"./ButtonAdd-adf1e21d.js";const Ne=async s=>{try{const v=B(),{data:l}=await N.get("/costs/activityexpenses",{headers:{token:v,farm:s}});return l}catch(v){return v}},Me=async(s,v)=>{try{const l=B(),{data:_}=await N.post("/costs/activityexpenses/register",{name:s.name,description:s.description,worth:s.worth,work:s.work,spent:s.spent},{headers:{token:l,farm:v}});return _}catch(l){return l}},Re=async(s,v)=>{try{const l=B(),{data:_}=await N.put(`/costs/activityexpenses/update/${s.id}`,{name:s.name,description:s.description,worth:s.worth,work:s.work,spent:s.spent},{headers:{token:l,farm:v}});return _}catch(l){return l}},Ue=async(s,v)=>{try{const l=B(),{data:_}=await N.put(`/costs/activityexpenses/inactivate/${s}`,{},{headers:{token:l,farm:v}});return _}catch(l){return l}},We=async(s,v)=>{try{const l=B(),{data:_}=await N.put(`/costs/activityexpenses/activate/${s}`,{},{headers:{token:l,farm:v}});return _}catch(l){return l}};const J=s=>(Oe("data-v-0c3f0373"),s=s(),Ge(),s),Fe={class:"q-py-sm table-container"},$e={class:"row"},je=J(()=>u("h6",{class:"title q-my-lg"},"Gastos de Actividades",-1)),Le={class:"container-content"},Qe={class:"container-table q-mt-md q-pa-md",rounded:""},He={class:"accions-td"},Je={class:"accions-td"},Ke=J(()=>u("i",{class:"icon icon-check"},null,-1)),Pe={class:"modal-activity"},Xe={class:"q-my-md text-center"},Ye={class:"row q-px-xl"},Ze={class:"col-12"},et=J(()=>u("span",{class:"text-required q-pb-sm"},[G("Todos los campos con "),u("span",{class:"text-red"},"*"),G(" son obligatorios")],-1)),tt={class:"row justify-center"},at={key:0,class:"spinner"},ot={__name:"ActivityExpenses",setup(s){const v=Ee(),l=Se(),_=n(""),m=n(!1),R=n(!0),S=n([]),D=n([]),K=n(),ce=Ve(),q=n(!1),P=se(()=>y.value==""||b.value==""||g.value==""?!0:q.value==!0),T=[e=>!!e||"Este campo es requerido"];let h=n(""),x=n("active"),y=n(""),g=n(""),b=n(""),A=n(""),E=n(""),X=n(""),U=n(""),W=n(""),F=n(""),Y=n("");const Z=n([{name:"id",label:"#",field:"id",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"name",label:"Nombre",field:"name",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"work",label:"Tipo Labor",field:"work",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"spent",label:"Tipo de gasto",field:"spent",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"description",label:"Descripción",field:"description",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"worth",label:"Valor",field:"worth",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Acciones",label:"Acciones",field:"acciones",align:"center",sortable:!0,headerStyle:"font-size: var(--font-medium); font-weight: bold;",style:"font-size: var(--font-medium);"}]),ue=e=>{y.value=e},de=e=>{A.value=e},ve=e=>{E.value=e},pe=e=>{g.value=e},fe=e=>{b.value=e},_e=()=>{_.value="REGISTRAR GASTO DE ACITIVIDAD",me(),R.value=!0,l.toggleModal()},me=()=>{U.value="",W.value="",F.value="",y.value="",g.value="",b.value=""},ye=e=>{_.value="EDITAR GASTO DE ACTIVIDAD",R.value=!1,K.value=e._id,U.value=e.name,W.value=e.description,F.value=e.worth,Y.value=e.work,y.value=e.name,g.value=e.description,b.value=e.worth,A.value=e.work,X.value=e.spent,E.value=e.spent,l.toggleModal()},w=(e,a)=>{v.notify({type:e,message:a,position:"top"})},C=async()=>{S.value=[],D.value=[],m.value=!0;try{const{activityexpenses:e}=await Ne(f.value),{works:a}=await L(f.value),{spents:c}=await Q(f.value);let M=1,$=1;e.forEach(d=>{d.status=d.status?"Inactivo":"Activo";let z=d.spent._id,V=d.work._id;c.forEach(k=>{k._id==z&&(z=k.name)}),d.spent=z,a.forEach(k=>{k._id==V&&(V=k.name)}),d.work=V,d.status=="Activo"?(d.id=M++,S.value.push(d)):(d.id=$++,D.value.push(d))}),m.value=!1}catch{m.value=!1,w("negative","Ocurrió un error")}};async function ge(){q.value=!0;const{works:e}=await L(f.value),{spents:a}=await Q(f.value);a.forEach(c=>{c.name==E.value&&(E.value=c._id)}),e.forEach(c=>{c.name==A.value&&(A.value=c._id)});try{await Me({name:y.value,description:g.value,worth:b.value,work:A.value,spent:E.value},f.value),q.value=!1,w("positive","Gasto de actividad registrado correctamente"),l.toggleModal(),S.value=[],C()}catch{q.value=!1,w("negative","Ocurrió un error, por favor verifique los datos")}}async function be(){q.value=!0;const{works:e}=await L(f.value),{spents:a}=await Q(f.value);e.forEach(c=>{c.name==A.value&&(A.value=c._id)}),a.forEach(c=>{c.name==E.value&&(E.value=c._id)});try{await Re({id:K.value,name:y.value,description:g.value,worth:b.value,work:A.value,spent:E.value},f.value),q.value=!1,w("positive","Gasto de actividad actualizado correctamente"),l.toggleModal(),S.value=[],C()}catch{q.value=!1,w("negative","Ocurrió un error, por favor verifique los datos")}y.value="",g.value="",b.value=""}async function he(e){m.value=!0;try{await We(e,f.value),w("positive","Gasto de actividad activado correctamente"),m.value=!1,S.value=[],D.value=[],C()}catch{m.value=!1,w("negative","Ocurrió un error")}}async function we(e){m.value=!1;try{await Ue(e,f.value),m.value=!1,w("positive","Gasto de actividad desactivado correctamente"),S.value=[],D.value=[],C()}catch{m.value=!1,w("negative","Ocurrió un error")}}const f=se(()=>ce.idSelected);return Ie(f,()=>{C()}),Ce(()=>{C()}),(e,a)=>{const c=p("q-separator"),M=p("q-tab"),$=p("q-tabs"),d=p("q-icon"),z=p("q-input"),V=p("q-tooltip"),k=p("q-btn"),ee=p("q-btn-group"),te=p("q-table"),ae=p("q-tab-panel"),ke=p("q-tab-panels"),qe=p("q-card"),xe=p("q-spinner-ios");return O(),le(De,null,[u("div",Fe,[u("div",$e,[u("i",{class:"icon icon-backRoute q-pt-lg",onClick:a[0]||(a[0]=o=>e.$router.back())}),je]),t(c,{class:"separator"}),u("div",Le,[t(Be,{onOnClick:_e,label:"Crear nuevo gasto de actividad"}),u("div",Qe,[t(qe,null,{default:r(()=>[t($,{modelValue:i(x),"onUpdate:modelValue":a[1]||(a[1]=o=>I(x)?x.value=o:x=o),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:r(()=>[t(M,{name:"active",label:"Activos"}),t(M,{name:"inactive",label:"Inactivos"})]),_:1},8,["modelValue"]),t(c),t(ke,{modelValue:i(x),"onUpdate:modelValue":a[4]||(a[4]=o=>I(x)?x.value=o:x=o),animated:""},{default:r(()=>[t(ae,{name:"active"},{default:r(()=>[t(te,{flat:"",bordered:"",title:"Gastos de Actividades","row-key":"name",rows:S.value,columns:Z.value,filter:i(h),loading:m.value,"rows-per-page-options":[5,10,20]},{"top-right":r(()=>[t(z,{borderless:"",dense:"",debounce:"300",modelValue:i(h),"onUpdate:modelValue":a[2]||(a[2]=o=>I(h)?h.value=o:h=o),placeholder:"Search"},{append:r(()=>[t(d,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":r(o=>[u("td",He,[t(ee,{class:"full-width full-height",outline:"",square:""},{default:r(()=>[t(k,{icon:"edit_note","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:oe=>ye(o.row)},{default:r(()=>[t(V,{class:"bg-indigo",offset:[10,10]},{default:r(()=>[G(" Editar ")]),_:1})]),_:2},1032,["onClick"]),t(k,{icon:"highlight_off","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:oe=>we(o.row._id)},{default:r(()=>[t(V,{class:"bg-indigo",offset:[10,10]},{default:r(()=>[G(" Desactivar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1}),t(ae,{name:"inactive"},{default:r(()=>[t(te,{flat:"",bordered:"",title:"Gastos de Actividades","row-key":"name",rows:D.value,columns:Z.value,filter:i(h),loading:m.value,"rows-per-page-options":[5,10,20]},{"top-right":r(()=>[t(z,{borderless:"",dense:"",debounce:"300",modelValue:i(h),"onUpdate:modelValue":a[3]||(a[3]=o=>I(h)?h.value=o:h=o),placeholder:"Search"},{append:r(()=>[t(d,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":r(o=>[u("td",Je,[t(ee,{class:"full-width full-height",outline:"",square:""},{default:r(()=>[t(k,{"text-color":"blue-10",class:"col q-pa-none",onClick:oe=>he(o.row._id)},{default:r(()=>[Ke,t(V,{class:"bg-indigo",offset:[10,10]},{default:r(()=>[G(" Activar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),i(l).modalIsOpen?(O(),j(ze,{key:0,class:"modal"},{default:r(()=>[u("div",Pe,[u("h6",Xe,Te(_.value),1),u("div",Ye,[u("div",Ze,[t(H,{label:"Nombre",required:!0,type:"text",ruless:T,value:i(U),modelValue:i(y),"onUpdate:modelValue":a[5]||(a[5]=o=>I(y)?y.value=o:y=o),onOnWrite:ue},null,8,["value","modelValue"]),t(H,{label:"Descripción",required:!0,type:"text",ruless:T,value:i(W),modelValue:i(g),"onUpdate:modelValue":a[6]||(a[6]=o=>I(g)?g.value=o:g=o),onOnWrite:pe},null,8,["value","modelValue"]),t(re,{class:"q-pb-md",onOnSelect:de,type:"work",required:!0,label:"Tipo de labor",ruless:T,value:i(Y)},null,8,["value"]),t(re,{class:"q-pb-md",onOnSelect:ve,type:"spent",required:!0,label:"Tipo de gasto",ruless:T,value:i(X)},null,8,["value"]),t(H,{class:"q-pb-xs",label:"Valor",required:!0,type:"text",ruless:T,value:i(F),modelValue:i(b),"onUpdate:modelValue":a[7]||(a[7]=o=>I(b)?b.value=o:b=o),onOnWrite:fe},null,8,["value","modelValue"]),et,u("div",tt,[R.value?(O(),j(ie,{key:0,disable:i(P),onOnClick:ge},null,8,["disable"])):(O(),j(ie,{key:1,disable:i(P),onOnClick:be},null,8,["disable"]))]),q.value?(O(),le("div",at,[t(xe,{color:"primary",size:"2.5em"})])):ne("",!0)])])])]),_:1})):ne("",!0)],64)}}},nt=Ae(ot,[["__scopeId","data-v-0c3f0373"]]);export{nt as default};
