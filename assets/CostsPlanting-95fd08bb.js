import{l as O,s as P,_ as ye,m as we,q as qe,g as r,v as ke,f as te,x as Ce,y as xe,r as v,o as I,c as ae,a as c,d as a,w as n,h as i,i as W,M as Ve,j as oe,F as Se,D as $,z as x,A as z,t as Ee,B as j,E as Ae,C as le,p as Ie,e as ze}from"./index-2fcec7ed.js";import{B as Oe}from"./ButtonAdd-246475aa.js";const Pe=async s=>{try{const d=O(),{data:l}=await P.get("/costs/costsplanting",{headers:{token:d,farm:s}});return l}catch(d){return d}},De=async(s,d)=>{try{const l=O(),{data:p}=await P.post("/costs/costsplanting/register",{name:s.name,description:s.description,worth:s.worth,lot:s.lot},{headers:{token:l,farm:d}});return p}catch(l){return l}},Be=async(s,d)=>{try{const l=O(),{data:p}=await P.put(`/costs/costsplanting/update/${s.id}`,{name:s.name,description:s.description,worth:s.worth,lot:s.lot},{headers:{token:l,farm:d}});return p}catch(l){return l}},Ge=async(s,d)=>{try{const l=O(),{data:p}=await P.put(`/costs/costsplanting/inactivate/${s}`,{},{headers:{token:l,farm:d}});return p}catch(l){return l}},Me=async(s,d)=>{try{const l=O(),{data:p}=await P.put(`/costs/costsplanting/activate/${s}`,{},{headers:{token:l,farm:d}});return p}catch(l){return l}};const Q=s=>(Ie("data-v-076cdf6e"),s=s(),ze(),s),Ne={class:"q-py-sm table-container"},Re={class:"row"},Le=Q(()=>c("h6",{class:"title q-my-lg"},"Gastos de Siembra",-1)),Te={class:"container-content"},Ue={class:"container-table q-mt-md q-pa-md",rounded:""},Fe={class:"accions-td"},We={class:"accions-td"},$e=Q(()=>c("i",{class:"icon icon-check"},null,-1)),je={class:"modal-planting"},Qe={class:"q-my-md text-center"},He={class:"row q-px-xl"},Je={class:"col-12"},Ke=Q(()=>c("span",{class:"text-required q-pb-sm"},[z("Todos los campos con "),c("span",{class:"text-red"},"*"),z(" son obligatorios")],-1)),Xe={class:"row justify-center"},Ye={key:0,class:"spinner"},Ze={__name:"CostsPlanting",setup(s){const d=we(),l=qe(),p=r(""),f=r(!1),G=r(!0),C=r([]),E=r([]),H=r(),se=ke(),q=r(!1),J=te(()=>_.value==""||m.value==""||g.value==""?!0:q.value==!0),M=[e=>!!e||"Este campo es requerido"];let b=r(""),k=r("active"),_=r(""),h=r(""),m=r(""),g=r(""),N=r(""),R=r(""),L=r(""),T=r("");const K=r([{name:"id",label:"#",field:"id",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"name",label:"Nombre",field:"name",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"description",label:"Descripción",field:"description",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"lot",label:"Lote",field:"lot",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"worth",label:"Valor",field:"worth",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Acciones",label:"Acciones",field:"acciones",align:"center",sortable:!0,headerStyle:"font-size: var(--font-medium); font-weight: bold;",style:"font-size: var(--font-medium);"}]),ne=e=>{_.value=e},re=e=>{h.value=e},ie=e=>{m.value=e},ce=e=>{g.value=e},ue=()=>{p.value="REGISTRAR GASTO DE SIEMBRA",de(),G.value=!0,l.toggleModal()},de=()=>{N.value="",L.value="",T.value="",R.value="",_.value="",h.value="",m.value="",g.value=""},ve=e=>{p.value="EDITAR GASTO DE SIEMBRA",G.value=!1,H.value=e._id,N.value=e.name,L.value=e.description,T.value=e.worth,_.value=e.name,h.value=e.description,m.value=e.worth,g.value=e.lot,R.value=e.lot,l.toggleModal()},y=(e,t)=>{d.notify({type:e,message:t,position:"top"})},V=async()=>{C.value=[],E.value=[],f.value=!0;try{const{costs:e}=await Pe(w.value),{lots:t}=await $(w.value);let D=1,B=1;e.forEach(u=>{u.status=u.status?"Inactivo":"Activo";let S=u.lot;t.forEach(A=>{A._id==S&&(S=A.name)}),u.lot=S,u.status=="Activo"?(u.id=D++,C.value.push(u)):(u.id=B++,E.value.push(u)),u.description=u.description.trim()==""?"No registra":u.description}),f.value=!1}catch{f.value=!1,y("negative","Ocurrió un error")}};async function pe(){q.value=!0;const{lots:e}=await $(w.value);e.forEach(t=>{t.name==g.value&&(g.value=t._id)});try{await De({name:_.value,description:h.value,worth:m.value,lot:g.value},w.value),q.value=!1,y("positive","Gasto de siembra registrado correctamente"),l.toggleModal(),C.value=[],V()}catch{q.value=!1,y("negative","Ocurrió un error, por favor verifique los datos")}}async function fe(){q.value=!0;const{lots:e}=await $(w.value);e.forEach(t=>{t.name==g.value&&(g.value=t._id)});try{await Be({id:H.value,name:_.value,description:h.value,worth:m.value,lot:g.value},w.value),q.value=!1,y("positive","Gasto de siembra actualizado correctamente"),l.toggleModal(),C.value=[],V()}catch{q.value=!1,y("negative","Ocurrió un error, por favor verifique los datos")}_.value="",h.value="",m.value=""}async function _e(e){f.value=!0;try{const t=await Me(e,w.value);y("positive","Gasto de siembra activado correctamente"),f.value=!1,C.value=[],E.value=[],V()}catch{f.value=!1,y("negative","Ocurrió un error")}}async function me(e){f.value=!1;try{const t=await Ge(e,w.value);f.value=!1,y("positive","Gasto de siembra desactivado correctamente"),C.value=[],E.value=[],V()}catch{f.value=!1,y("negative","Ocurrió un error")}}const w=te(()=>se.idSelected);return Ce(w,()=>{V()}),xe(()=>{V()}),(e,t)=>{const D=v("q-separator"),B=v("q-tab"),u=v("q-tabs"),S=v("q-icon"),A=v("q-input"),U=v("q-tooltip"),F=v("q-btn"),X=v("q-btn-group"),Y=v("q-table"),Z=v("q-tab-panel"),ge=v("q-tab-panels"),be=v("q-card"),he=v("q-spinner-ios");return I(),ae(Se,null,[c("div",Ne,[c("div",Re,[c("i",{class:"icon icon-backRoute q-pt-lg",onClick:t[0]||(t[0]=o=>e.$router.back())}),Le]),a(D,{class:"separator"}),c("div",Te,[a(Oe,{onOnClick:ue,label:"Crear nuevo gasto de siembra"}),c("div",Ue,[a(be,null,{default:n(()=>[a(u,{modelValue:i(k),"onUpdate:modelValue":t[1]||(t[1]=o=>x(k)?k.value=o:k=o),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:n(()=>[a(B,{name:"active",label:"Activos"}),a(B,{name:"inactive",label:"Inactivos"})]),_:1},8,["modelValue"]),a(D),a(ge,{modelValue:i(k),"onUpdate:modelValue":t[4]||(t[4]=o=>x(k)?k.value=o:k=o),animated:""},{default:n(()=>[a(Z,{name:"active"},{default:n(()=>[a(Y,{flat:"",bordered:"",title:"Gastos de Siembra","row-key":"name",rows:C.value,columns:K.value,filter:i(b),loading:f.value,"rows-per-page-options":[5,10,20]},{"top-right":n(()=>[a(A,{borderless:"",dense:"",debounce:"300",modelValue:i(b),"onUpdate:modelValue":t[2]||(t[2]=o=>x(b)?b.value=o:b=o),placeholder:"Search"},{append:n(()=>[a(S,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":n(o=>[c("td",Fe,[a(X,{class:"full-width full-height",outline:"",square:""},{default:n(()=>[a(F,{icon:"edit_note","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:ee=>ve(o.row)},{default:n(()=>[a(U,{class:"bg-indigo",offset:[10,10]},{default:n(()=>[z(" Editar ")]),_:1})]),_:2},1032,["onClick"]),a(F,{icon:"highlight_off","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:ee=>me(o.row._id)},{default:n(()=>[a(U,{class:"bg-indigo",offset:[10,10]},{default:n(()=>[z(" Desactivar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1}),a(Z,{name:"inactive"},{default:n(()=>[a(Y,{flat:"",bordered:"",title:"Gastos de Actividades","row-key":"name",rows:E.value,columns:K.value,filter:i(b),loading:f.value,"rows-per-page-options":[5,10,20]},{"top-right":n(()=>[a(A,{borderless:"",dense:"",debounce:"300",modelValue:i(b),"onUpdate:modelValue":t[3]||(t[3]=o=>x(b)?b.value=o:b=o),placeholder:"Search"},{append:n(()=>[a(S,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":n(o=>[c("td",We,[a(X,{class:"full-width full-height",outline:"",square:""},{default:n(()=>[a(F,{"text-color":"blue-10",class:"col q-pa-none",onClick:ee=>_e(o.row._id)},{default:n(()=>[$e,a(U,{class:"bg-indigo",offset:[10,10]},{default:n(()=>[z(" Activar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),i(l).modalIsOpen?(I(),W(Ve,{key:0,class:"modal"},{default:n(()=>[c("div",je,[c("h6",Qe,Ee(p.value),1),c("div",He,[c("div",Je,[a(j,{label:"Nombre",required:!0,type:"text",ruless:M,value:i(N),modelValue:i(_),"onUpdate:modelValue":t[5]||(t[5]=o=>x(_)?_.value=o:_=o),onOnWrite:ne},null,8,["value","modelValue"]),a(Ae,{class:"q-pb-lg",type:"lots",label:"Lote","v-model":i(g),required:!0,ruless:M,value:i(R),onOnSelect:ce},null,8,["v-model","value"]),a(j,{label:"Valor",type:"text",required:!0,ruless:M,value:i(T),modelValue:i(m),"onUpdate:modelValue":t[6]||(t[6]=o=>x(m)?m.value=o:m=o),onOnWrite:ie},null,8,["value","modelValue"]),a(j,{class:"q-mb-md",label:"Descripción",type:"text",required:!1,value:i(L),modelValue:i(h),"onUpdate:modelValue":t[7]||(t[7]=o=>x(h)?h.value=o:h=o),onOnWrite:re},null,8,["value","modelValue"]),Ke,c("div",Xe,[G.value?(I(),W(le,{key:0,disable:i(J),onOnClick:pe},null,8,["disable"])):(I(),W(le,{key:1,disable:i(J),onOnClick:fe},null,8,["disable"]))]),q.value?(I(),ae("div",Ye,[a(he,{color:"primary",size:"2.5em"})])):oe("",!0)])])])]),_:1})):oe("",!0)],64)}}},at=ye(Ze,[["__scopeId","data-v-076cdf6e"]]);export{at as default};
