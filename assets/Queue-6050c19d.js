import{g as Oe,p as Ee,a as Ie,i as Ae,d as De}from"./index-eb3b13b6.js";import{B as Ue}from"./ButtonAdd-246475aa.js";import{_ as ze,m as Ne,q as Re,a5 as Me,g as d,v as Be,f as P,x as Te,y as Fe,r as c,a6 as Pe,o as E,c as W,a as e,d as t,w as s,h as n,i as L,M as J,j as z,F as Le,z as b,A as u,t as x,E as K,a7 as Qe,C as je,B as $e,p as Ge,e as He,a8 as We,a0 as Je}from"./index-2fcec7ed.js";const p=R=>(Ge("data-v-457ad7d4"),R=R(),He(),R),Ke={class:"q-py-md table-container"},Xe={class:"row"},Ye=p(()=>e("h6",{class:"title q-my-lg"},"PEDIDOS EN CURSO",-1)),Ze={class:"container-content"},et={class:"container-table q-mt-md q-pa-md",rounded:""},tt={class:"accions-td"},lt={class:"accions-td"},at=p(()=>e("i",{class:"icon icon-check"},null,-1)),ot={class:"modalSystem"},st={class:"q-my-md text-center"},nt={class:"column q-px-xl"},rt={class:"col-12"},dt={class:"q-pt-md"},it=p(()=>e("span",null,[u("Fecha de entrega"),e("span",{style:{color:"red"}},"*")],-1)),ct={class:"row items-center justify-end"},ut={class:"q-pt-lg q-pb-sm column"},vt=p(()=>e("span",null,"Detalle del pedido:",-1)),_t={class:"column"},pt={class:"accions-td"},mt=p(()=>e("span",null,"Total:",-1)),ft={class:"total"},gt=p(()=>e("span",{class:"text-required q-py-sm"},[u("Todos los campos con "),e("span",{class:"text-red"},"*"),u(" son obligatorios")],-1)),bt={class:"row justify-center q-mt-sm"},ht={key:0,class:"spinner"},yt={class:"modalSystem"},qt={class:"q-my-md q-pt-lg text-center"},wt={class:"row q-px-xl"},xt={class:"col-12"},St={class:"row q-mt-xs buttons-modal"},Vt={key:0,class:"spinner"},kt={class:"modalSystem"},Ct={class:"q-my-md text-center"},Ot={class:"row q-px-xl"},Et={class:"column col-12",style:{"font-size":"16px"}},It={class:"q-pb-sm"},At=p(()=>e("span",{class:"text-bold"},"Cliente:",-1)),Dt={class:"q-pb-sm"},Ut=p(()=>e("span",{class:"text-bold"},"Estado de la orden:",-1)),zt={class:"q-pb-sm"},Nt=p(()=>e("span",{class:"text-bold"},"Estado del pago:",-1)),Rt={class:"q-pb-sm"},Mt=p(()=>e("span",{class:"text-bold"},"Fecha de entrega:",-1)),Bt={class:"q-pb-sm"},Tt=p(()=>e("span",{class:"text-bold"},"Valor total:",-1)),Ft={class:"q-pb-sm column"},Pt=p(()=>e("span",{class:"text-bold"},"Detalle del pedido:",-1)),Lt={class:"column"},Qt={__name:"Queue",setup(R){const le=Ne(),Q=Re(),X=Me(),I=d(""),v=d(!1),h=d(!1),O=d([]),A=d([]),_=d([]),ae=Be(),M=d(!1);let D=d(""),j=d([]),m=d(""),y=d(""),f=d(""),S=d(""),V=d(0),g=d(""),k=d("active");const oe=P(()=>{let o=0;return _.value.forEach(l=>{o+=l.cost}),o}),se=P(()=>!y.value||!V.value?!0:h.value==!0),ne=P(()=>!f.value||_.value.length==0||!m.value||!S.value?!0:h.value==!0),B=[o=>!!o||"Este campo es requerido"],Y=d([{name:"Acciones",field:"acciones",align:"left",sortable:!0,headerStyle:"font-weight: bold;",style:"width: 10px"},{name:"name",label:"Nombre",field:"name",align:"left",sortable:!0,headerStyle:"font-weight: bold;"},{name:"unitvalue",label:"Valor unitario",field:"unitvalue",align:"left",sortable:!0,headerStyle:"font-weight: bold;"},{name:"quantity",label:"Cantidad",field:"quantity",align:"left",sortable:!0,headerStyle:"font-weight: bold;"},{name:"cost",label:"Total",field:"cost",align:"left",sortable:!0,headerStyle:"font-weight: bold;"}]),Z=d([{name:"id",label:"#",field:"id",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"client",label:"Cliente",field:"client",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"statusorder",label:"Estado de orden",field:"statusorder",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"dateorder",label:"Fecha entrega",field:"dateorder",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Acciones",label:"Acciones",field:"acciones",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"}]),re=o=>{delete _.value[o]},de=o=>{f.value=o},ie=o=>{y.value=o},ce=o=>{S.value=o},ue=o=>{V.value=o},ve=async()=>{h.value=!0;const{models:o}=await We(C.value);h.value=!1,M.value=!1;let l={};o.forEach(i=>{i.name==y.value&&(l={codigo:_.value.length,id:i._id,name:y.value,unitvalue:i.unitvalue,quantity:parseInt(V.value),cost:i.unitvalue*V.value},_.value.push(l))})},_e=()=>{I.value="Registro de item",M.value=!0},pe=()=>{I.value="REGISTRAR PEDIDO",fe(),Q.toggleModal()},me=()=>{M.value=!1,y.value=""},fe=()=>{f.value="",m.value="",S.value="",_.value=[],j.value=[]},ge=o=>{_.value=[];let l=1;I.value="DETALLE DE LA ORDEN",D.value=o,o.models.forEach(r=>{r.id=l++,_.value.push(r)}),X.toggleSHowDetailsModal()},q=(o,l)=>{le.notify({type:o,message:l,position:"top"})};async function U(){O.value=[],A.value=[],v.value=!0;try{const{orders:o}=await Oe(C.value);v.value=!1;let l=1,i=1;o&&o.forEach(r=>{r.status=r.status?"Inactivo":"Activo",r.statusorder=="PENDIENTE"?(r.id=l++,O.value.push(r)):r.statusorder=="CANCELADO"&&(r.id=i++,A.value.push(r)),r.client=r.client.name,r.dateorder=r.dateorder.slice(0,r.dateorder.indexOf("T"))})}catch{v.value=!1,q("negative","Ocurrió un error al obtener las ordenes")}}async function be(){let o={};_.value.forEach(i=>{o={id:i.id,quantity:i.quantity},j.value.push(o)}),_.value=[],h.value=!0;const{client:l}=await Je(C.value);l.forEach(i=>{i.name==f.value&&(f.value=i._id)});try{await Ee({models:j.value,client:f.value,dateorder:m.value,statusorder:S.value},C.value),h.value=!1,Q.toggleModal(),O.value=[],q("positive","Usuario registrado correctamente"),U()}catch{h.value=!1,q("negative","Ocurrió un error")}}async function he(o){v.value=!0;try{await Ie(o,C.value),v.value=!1,q("positive","Usuario activado correctamente"),O.value=[],A.value=[],U()}catch{v.value=!1,q("negative","Ocurrió un error al activar el usuario")}}async function ye(o){v.value=!0;try{await Ae(o,C.value),q("positive","Usuario desactivado correctamente"),v.value=!1,O.value=[],A.value=[],U()}catch{v.value=!1,q("negative","Ocurrió un error al desactivar el usuario")}}async function qe(o){v.value=!0;try{await De(o,C.value),q("positive","Pedido entregado correctamente"),v.value=!1,O.value=[],A.value=[],U()}catch{v.value=!1,q("negative","Ocurrió un error al entregar el pedido")}}const C=P(()=>ae.idSelected);return Te(C,()=>{U()}),Fe(()=>{U()}),(o,l)=>{const i=c("q-separator"),r=c("q-tab"),we=c("q-tabs"),$=c("q-icon"),G=c("q-input"),N=c("q-tooltip"),w=c("q-btn"),H=c("q-btn-group"),T=c("q-table"),ee=c("q-tab-panel"),xe=c("q-tab-panels"),Se=c("q-card"),Ve=c("q-date"),ke=c("q-popup-proxy"),te=c("q-spinner-ios"),Ce=Pe("close-popup");return E(),W(Le,null,[e("div",Ke,[e("div",Xe,[e("i",{class:"icon icon-backRoute q-pt-lg",onClick:l[0]||(l[0]=a=>o.$router.back())}),Ye]),t(i,{class:"separator"}),e("div",Ze,[t(Ue,{onOnClick:pe,label:"Crear nuevo pedido"}),e("div",et,[t(Se,null,{default:s(()=>[t(we,{modelValue:n(k),"onUpdate:modelValue":l[1]||(l[1]=a=>b(k)?k.value=a:k=a),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:s(()=>[t(r,{name:"active",label:"Activos"}),t(r,{name:"inactive",label:"Inactivos"})]),_:1},8,["modelValue"]),t(i),t(xe,{modelValue:n(k),"onUpdate:modelValue":l[4]||(l[4]=a=>b(k)?k.value=a:k=a),animated:""},{default:s(()=>[t(ee,{name:"active"},{default:s(()=>[t(T,{flat:"",bordered:"",title:"Pedidos","row-key":"id",rows:O.value,columns:Z.value,filter:n(g),loading:v.value,"rows-per-page-options":[5,10,20]},{"top-right":s(()=>[t(G,{borderless:"",dense:"",debounce:"300",modelValue:n(g),"onUpdate:modelValue":l[2]||(l[2]=a=>b(g)?g.value=a:g=a),placeholder:"Buscar"},{append:s(()=>[t($,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":s(a=>[e("td",tt,[t(H,{class:"full-width full-height",outline:"",square:""},{default:s(()=>[t(w,{icon:"visibility","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:F=>ge(a.row)},{default:s(()=>[t(N,{class:"bg-indigo",offset:[10,10]},{default:s(()=>[u(" Ver detalles ")]),_:1})]),_:2},1032,["onClick"]),a.row.statusorder=="PENDIENTE"?(E(),L(w,{key:0,icon:"check_circle","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:F=>qe(a.row._id)},{default:s(()=>[t(N,{class:"bg-indigo",offset:[10,10]},{default:s(()=>[u(" Marcar como entregado ")]),_:1})]),_:2},1032,["onClick"])):z("",!0),t(w,{icon:"highlight_off","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:F=>ye(a.row._id)},{default:s(()=>[t(N,{class:"bg-indigo",offset:[10,10]},{default:s(()=>[u(" Cancelar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1}),t(ee,{name:"inactive"},{default:s(()=>[t(T,{flat:"",bordered:"",title:"Usuarios","row-key":"id",rows:A.value,columns:Z.value,filter:n(g),loading:v.value,"rows-per-page-options":[5,10,20]},{"top-right":s(()=>[t(G,{borderless:"",dense:"",debounce:"300",modelValue:n(g),"onUpdate:modelValue":l[3]||(l[3]=a=>b(g)?g.value=a:g=a),placeholder:"Buscar"},{append:s(()=>[t($,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":s(a=>[e("td",lt,[t(H,{class:"full-width full-height",outline:"",square:""},{default:s(()=>[t(w,{"text-color":"blue-10",class:"col q-pa-none",onClick:F=>he(a.row._id)},{default:s(()=>[at,t(N,{class:"bg-indigo",offset:[10,10]},{default:s(()=>[u(" Activar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),n(Q).modalIsOpen?(E(),L(J,{key:0,class:"modal"},{default:s(()=>[e("div",ot,[e("h6",st,x(I.value),1),e("div",nt,[e("div",rt,[t(K,{label:"Cliente",type:"client",required:!0,ruless:B,modelValue:n(f),"onUpdate:modelValue":l[5]||(l[5]=a=>b(f)?f.value=a:f=a),onOnSelect:de},null,8,["modelValue"]),e("div",dt,[it,t(G,{filled:"",dense:"",modelValue:n(m),"onUpdate:modelValue":l[7]||(l[7]=a=>b(m)?m.value=a:m=a),mask:"date",rules:["date"]},{append:s(()=>[t($,{name:"event",class:"cursor-pointer"},{default:s(()=>[t(ke,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[t(Ve,{modelValue:n(m),"onUpdate:modelValue":l[6]||(l[6]=a=>b(m)?m.value=a:m=a)},{default:s(()=>[e("div",ct,[Qe(t(w,{label:"Close",color:"primary",flat:""},null,512),[[Ce]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),t(K,{type:"state",ruless:B,required:!0,label:"Estado de orden",modelValue:n(S),"onUpdate:modelValue":l[8]||(l[8]=a=>b(S)?S.value=a:S=a),onOnSelect:ce},null,8,["modelValue"]),e("div",ut,[vt,e("div",_t,[t(T,{flat:"",bordered:"",style:{"max-width":"300px"},"row-key":"id",rows:_.value,columns:Y.value,"rows-per-page-options":[5,10,20],"hide-bottom":""},{"body-cell-Acciones":s(a=>[e("td",pt,[t(H,{class:"full-width full-height",outline:"",square:""},{default:s(()=>[t(w,{"text-color":"blue-10",class:"col q-pa-none",icon:"delete",onClick:F=>re(a.row.codigo)},{default:s(()=>[t(N,{class:"bg-indigo",offset:[10,10]},{default:s(()=>[u(" Eliminar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns"])])]),t(w,{icon:"add",class:"button-add",label:"Agregar",onClick:l[9]||(l[9]=a=>_e())}),e("div",null,[mt,e("span",ft,x(n(oe)),1)]),gt,e("div",bt,[t(je,{disable:n(ne),onOnClick:be},null,8,["disable"])]),h.value?(E(),W("div",ht,[t(te,{color:"primary",size:"2.5em"})])):z("",!0)])])])]),_:1})):z("",!0),M.value?(E(),L(J,{key:1,class:"modal",show:"false"},{default:s(()=>[e("div",yt,[e("h6",qt,x(I.value),1),e("div",wt,[e("div",xt,[t(K,{type:"models",ruless:B,required:!0,label:"Producto",modelValue:n(y),"onUpdate:modelValue":l[10]||(l[10]=a=>b(y)?y.value=a:y=a),onOnSelect:ie},null,8,["modelValue"]),t($e,{class:"q-mt-lg",label:"Cantidad",required:!0,type:"number",ruless:B,modelValue:n(V),"onUpdate:modelValue":l[11]||(l[11]=a=>b(V)?V.value=a:V=a),onOnWrite:ue},null,8,["modelValue"]),e("div",St,[t(w,{class:"q-mx-sm button-one",onClick:l[12]||(l[12]=a=>me())},{default:s(()=>[u("Cancelar")]),_:1}),t(w,{class:"q-mx-sm button-one",onClick:l[13]||(l[13]=a=>ve()),disable:n(se)},{default:s(()=>[u("Agregar")]),_:1},8,["disable"])]),h.value?(E(),W("div",Vt,[t(te,{color:"primary",size:"2.5em"})])):z("",!0)])])])]),_:1})):z("",!0),n(X).modalShowIsOpen?(E(),L(J,{key:2,class:"modal",showDetail:!0},{default:s(()=>[e("div",kt,[e("h6",Ct,x(I.value),1),e("div",Ot,[e("div",Et,[e("div",It,[At,u(" "+x(n(D).client),1)]),e("div",Dt,[Ut,u(" "+x(n(D).statusorder),1)]),e("div",zt,[Nt,u(" "+x(n(D).statuspay),1)]),e("div",Rt,[Mt,u(" "+x(n(D).dateorder),1)]),e("div",Bt,[Tt,u(" "+x(n(D).total),1)]),e("div",Ft,[Pt,e("div",Lt,[t(T,{flat:"",bordered:"",style:{"max-width":"300px"},"row-key":"codigo",rows:_.value,columns:Y.value,"rows-per-page-options":[5,10,20]},null,8,["rows","columns"])])])])])])]),_:1})):z("",!0)],64)}}},Ht=ze(Qt,[["__scopeId","data-v-457ad7d4"]]);export{Ht as default};
