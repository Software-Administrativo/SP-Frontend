import{v as B,x as G,_ as Ce,f as xe,y as Ee,g as n,z as Ve,h as le,A as Ae,C as Ie,r as p,o as P,c as se,a as d,d as t,w as r,i,q as j,M as ze,l as ne,F as Oe,H,E as Q,j as A,m as D,t as Pe,k as J,G as re,B as ie,p as De,e as Be}from"./index-21ef78fb.js";import{B as Ge}from"./ButtonAdd-adf1e21d.js";const Te=async l=>{try{const v=B(),{data:s}=await G.get("/costs/costsplanting",{headers:{token:v,farm:l}});return s}catch(v){return v}},Me=async(l,v)=>{try{const s=B(),{data:g}=await G.post("/costs/costsplanting/register",{name:l.name,description:l.description,lot:l.lot,worth:l.worth,spent:l.spent},{headers:{token:s,farm:v}});return g}catch(s){return s}},Ne=async(l,v)=>{try{const s=B(),{data:g}=await G.put(`/costs/costsplanting/update/${l.id}`,{name:l.name,description:l.description,worth:l.worth,lot:l.lot,spent:l.spent},{headers:{token:s,farm:v}});return g}catch(s){return s}},Re=async(l,v)=>{try{const s=B(),{data:g}=await G.put(`/costs/costsplanting/inactivate/${l}`,{},{headers:{token:s,farm:v}});return g}catch(s){return s}},Le=async(l,v)=>{try{const s=B(),{data:g}=await G.put(`/costs/costsplanting/activate/${l}`,{},{headers:{token:s,farm:v}});return g}catch(s){return s}};const K=l=>(De("data-v-dfbef963"),l=l(),Be(),l),Ue={class:"q-py-sm table-container"},Fe={class:"row"},We=K(()=>d("h6",{class:"title q-my-lg"},"Gastos de Siembra",-1)),$e={class:"container-content"},je={class:"container-table q-mt-md q-pa-md",rounded:""},He={class:"accions-td"},Qe={class:"accions-td"},Je=K(()=>d("i",{class:"icon icon-check"},null,-1)),Ke={class:"modal-planting"},Xe={class:"q-my-md text-center"},Ye={class:"row q-px-xl"},Ze={class:"col-12"},et=K(()=>d("span",{class:"text-required q-pb-sm"},[D("Todos los campos con "),d("span",{class:"text-red"},"*"),D(" son obligatorios")],-1)),tt={class:"row justify-center"},at={key:0,class:"spinner"},ot={__name:"CostsPlanting",setup(l){const v=xe(),s=Ee(),g=n(""),_=n(!1),N=n(!0),E=n([]),O=n([]),X=n(),ce=Ve(),C=n(!1),Y=le(()=>m.value==""||b.value==""||h.value==""?!0:C.value==!0),T=[e=>!!e||"Este campo es requerido"];let y=n(""),x=n("active"),m=n(""),w=n(""),b=n(""),h=n(""),q=n(""),R=n(""),L=n(""),U=n(""),F=n(""),W=n("");const Z=n([{name:"id",label:"#",field:"id",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"name",label:"Nombre",field:"name",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"spent",label:"Tipo de gasto",field:"spent",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"description",label:"Descripción",field:"description",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"lot",label:"Lote",field:"lot",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"worth",label:"Valor",field:"worth",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Acciones",label:"Acciones",field:"acciones",align:"center",sortable:!0,headerStyle:"font-size: var(--font-medium); font-weight: bold;",style:"font-size: var(--font-medium);"}]),ue=e=>{m.value=e},de=e=>{w.value=e},ve=e=>{b.value=e},pe=e=>{h.value=e},fe=e=>{q.value=e},ge=()=>{g.value="REGISTRAR GASTO DE SIEMBRA",_e(),N.value=!0,s.toggleModal()},_e=()=>{L.value="",F.value="",W.value="",U.value="",m.value="",w.value="",b.value="",h.value="",R.value="",q.value=""},me=e=>{g.value="EDITAR GASTO DE SIEMBRA",N.value=!1,X.value=e._id,L.value=e.name,F.value=e.description,W.value=e.worth,m.value=e.name,q.value=e.spent,w.value=e.description,b.value=e.worth,h.value=e.lot,U.value=e.lot,R.value=e.spent,s.toggleModal()},k=(e,a)=>{v.notify({type:e,message:a,position:"top"})},I=async()=>{E.value=[],O.value=[],_.value=!0;try{const{costs:e}=await Te(f.value),{lots:a}=await H(f.value),{spents:u}=await Q(f.value);let M=1,$=1;e.forEach(c=>{c.status=c.status?"Inactivo":"Activo";let z=c.lot,V=c.spent._id;u.forEach(S=>{S._id==V&&(V=S.name)}),c.spent=V,a.forEach(S=>{S._id==z&&(z=S.name)}),c.lot=z,c.status=="Activo"?(c.id=M++,E.value.push(c)):(c.id=$++,O.value.push(c)),c.description=c.description.trim()==""?"No registra":c.description}),_.value=!1}catch{_.value=!1,k("negative","Ocurrió un error")}};async function be(){C.value=!0;const{lots:e}=await H(f.value),{spents:a}=await Q(f.value);e.forEach(u=>{u.name==h.value&&(h.value=u._id)}),a.forEach(u=>{u.name==q.value&&(q.value=u._id)});try{await Me({name:m.value,description:w.value,worth:b.value,lot:h.value,spent:q.value},f.value),C.value=!1,k("positive","Gasto de siembra registrado correctamente"),s.toggleModal(),E.value=[],I()}catch{C.value=!1,k("negative","Ocurrió un error, por favor verifique los datos")}}async function he(){C.value=!0;const{lots:e}=await H(f.value),{spents:a}=await Q(f.value);e.forEach(u=>{u.name==h.value&&(h.value=u._id)}),a.forEach(u=>{u.name==q.value&&(q.value=u._id)});try{await Ne({id:X.value,name:m.value,description:w.value,worth:b.value,lot:h.value,spent:q.value},f.value),C.value=!1,k("positive","Gasto de siembra actualizado correctamente"),s.toggleModal(),E.value=[],I()}catch{C.value=!1,k("negative","Ocurrió un error, por favor verifique los datos")}m.value="",w.value="",b.value=""}async function ye(e){_.value=!0;try{const a=await Le(e,f.value);k("positive","Gasto de siembra activado correctamente"),_.value=!1,E.value=[],O.value=[],I()}catch{_.value=!1,k("negative","Ocurrió un error")}}async function we(e){_.value=!1;try{const a=await Re(e,f.value);_.value=!1,k("positive","Gasto de siembra desactivado correctamente"),E.value=[],O.value=[],I()}catch{_.value=!1,k("negative","Ocurrió un error")}}const f=le(()=>ce.idSelected);return Ae(f,()=>{I()}),Ie(()=>{I()}),(e,a)=>{const u=p("q-separator"),M=p("q-tab"),$=p("q-tabs"),c=p("q-icon"),z=p("q-input"),V=p("q-tooltip"),S=p("q-btn"),ee=p("q-btn-group"),te=p("q-table"),ae=p("q-tab-panel"),qe=p("q-tab-panels"),ke=p("q-card"),Se=p("q-spinner-ios");return P(),se(Oe,null,[d("div",Ue,[d("div",Fe,[d("i",{class:"icon icon-backRoute q-pt-lg",onClick:a[0]||(a[0]=o=>e.$router.back())}),We]),t(u,{class:"separator"}),d("div",$e,[t(Ge,{onOnClick:ge,label:"Crear nuevo gasto de siembra"}),d("div",je,[t(ke,null,{default:r(()=>[t($,{modelValue:i(x),"onUpdate:modelValue":a[1]||(a[1]=o=>A(x)?x.value=o:x=o),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:r(()=>[t(M,{name:"active",label:"Activos"}),t(M,{name:"inactive",label:"Inactivos"})]),_:1},8,["modelValue"]),t(u),t(qe,{modelValue:i(x),"onUpdate:modelValue":a[4]||(a[4]=o=>A(x)?x.value=o:x=o),animated:""},{default:r(()=>[t(ae,{name:"active"},{default:r(()=>[t(te,{flat:"",bordered:"",title:"Gastos de Siembra","row-key":"name",rows:E.value,columns:Z.value,filter:i(y),loading:_.value,"rows-per-page-options":[5,10,20]},{"top-right":r(()=>[t(z,{borderless:"",dense:"",debounce:"300",modelValue:i(y),"onUpdate:modelValue":a[2]||(a[2]=o=>A(y)?y.value=o:y=o),placeholder:"Search"},{append:r(()=>[t(c,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":r(o=>[d("td",He,[t(ee,{class:"full-width full-height",outline:"",square:""},{default:r(()=>[t(S,{icon:"edit_note","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:oe=>me(o.row)},{default:r(()=>[t(V,{class:"bg-indigo",offset:[10,10]},{default:r(()=>[D(" Editar ")]),_:1})]),_:2},1032,["onClick"]),t(S,{icon:"highlight_off","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:oe=>we(o.row._id)},{default:r(()=>[t(V,{class:"bg-indigo",offset:[10,10]},{default:r(()=>[D(" Desactivar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1}),t(ae,{name:"inactive"},{default:r(()=>[t(te,{flat:"",bordered:"",title:"Gastos de Actividades","row-key":"name",rows:O.value,columns:Z.value,filter:i(y),loading:_.value,"rows-per-page-options":[5,10,20]},{"top-right":r(()=>[t(z,{borderless:"",dense:"",debounce:"300",modelValue:i(y),"onUpdate:modelValue":a[3]||(a[3]=o=>A(y)?y.value=o:y=o),placeholder:"Search"},{append:r(()=>[t(c,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":r(o=>[d("td",Qe,[t(ee,{class:"full-width full-height",outline:"",square:""},{default:r(()=>[t(S,{"text-color":"blue-10",class:"col q-pa-none",onClick:oe=>ye(o.row._id)},{default:r(()=>[Je,t(V,{class:"bg-indigo",offset:[10,10]},{default:r(()=>[D(" Activar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),i(s).modalIsOpen?(P(),j(ze,{key:0,class:"modal"},{default:r(()=>[d("div",Ke,[d("h6",Xe,Pe(g.value),1),d("div",Ye,[d("div",Ze,[t(J,{label:"Nombre",required:!0,type:"text",ruless:T,value:i(L),modelValue:i(m),"onUpdate:modelValue":a[5]||(a[5]=o=>A(m)?m.value=o:m=o),onOnWrite:ue},null,8,["value","modelValue"]),t(re,{class:"q-pb-lg",type:"lots",label:"Lote","v-model":i(h),required:!0,ruless:T,value:i(U),onOnSelect:pe},null,8,["v-model","value"]),t(re,{class:"q-pb-md",onOnSelect:fe,type:"spent",required:!0,label:"Tipo de gasto",ruless:T,value:i(R)},null,8,["value"]),t(J,{label:"Valor",type:"text",required:!0,ruless:T,value:i(W),modelValue:i(b),"onUpdate:modelValue":a[6]||(a[6]=o=>A(b)?b.value=o:b=o),onOnWrite:ve},null,8,["value","modelValue"]),t(J,{class:"q-mb-md",label:"Descripción",type:"text",required:!1,value:i(F),modelValue:i(w),"onUpdate:modelValue":a[7]||(a[7]=o=>A(w)?w.value=o:w=o),onOnWrite:de},null,8,["value","modelValue"]),et,d("div",tt,[N.value?(P(),j(ie,{key:0,disable:i(Y),onOnClick:be},null,8,["disable"])):(P(),j(ie,{key:1,disable:i(Y),onOnClick:he},null,8,["disable"]))]),C.value?(P(),se("div",at,[t(Se,{color:"primary",size:"2.5em"})])):ne("",!0)])])])]),_:1})):ne("",!0)],64)}}},nt=Ce(ot,[["__scopeId","data-v-dfbef963"]]);export{nt as default};
