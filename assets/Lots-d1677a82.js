import{_ as Ce,f as Ae,y as De,g as s,z as Ee,h as ne,A as Ue,C as Me,r as i,o as I,c as ue,a as u,d as t,w as n,i as o,q as E,M as Ne,l as Q,F as Be,D as X,j as c,m as A,t as Te,k as U,E as M,B as re,p as Re,e as Fe,X as We,Y as je,Z as He,$ as Je}from"./index-f354315f.js";import{B as Ge}from"./ButtonAdd-9b531d6c.js";const Y=D=>(Re("data-v-dcf06947"),D=D(),Fe(),D),Pe={class:"q-py-md table-container"},Qe={class:"row"},Xe=Y(()=>u("h6",{class:"title q-my-lg"},"LOTES",-1)),Ye={class:"container-content"},Ze={class:"container-table q-mt-md q-pa-md",rounded:""},Ke={class:"accions-td"},$e={class:"accions-td"},ea=Y(()=>u("i",{class:"icon icon-check"},null,-1)),aa={class:"modal-lots"},la={class:"q-my-md text-center"},ta={class:"row q-px-xl"},oa={class:"col-12"},sa=Y(()=>u("span",{class:"text-required q-pb-sm"},[A("Todos los campos con "),u("span",{class:"text-red"},"*"),A(" son obligatorios")],-1)),na={class:"row justify-center"},ua={key:1,class:"spinner"},ra={__name:"Lots",setup(D){const ie=Ae(),O=De(),N=s(""),v=s(!1),B=s(!0),V=s([]),C=s([]),Z=s(),de=Ee(),L=s(!1),K=ne(()=>(f.value,m.value,g.value,_.value,d.value,b.value?L.value==!0:!0)),z=[e=>!!e||"Este campo es requerido"];let p=s(""),w=s("active"),f=s(""),m=s(""),g=s(""),_=s(""),d=s(""),b=s(""),q=s(""),k=s(""),T=s(""),R=s(""),F=s(""),W=s(""),j=s(""),H=s(""),J=s(""),ce=s("");const $=s([{name:"id",label:"#",field:"id",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"name",label:"Nombre",field:"name",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"areasize",label:"Tamaño",field:"areasize",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"soildstate",label:"Estado del suelo",field:"soildstate",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"classlot",label:"Clase",field:"classlote",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"fatherlot",label:"Lote padre",field:"fatherlot",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"sowingdensity",label:"Densidad de siembra",field:"sowingdensity",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Acciones",label:"Acciones",field:"acciones",align:"center",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"}]),ve=e=>{f.value=e},pe=e=>{m.value=e},fe=e=>{g.value=e},me=e=>{_.value=e},ge=e=>{d.value=e},_e=e=>{b.value=e},be=e=>{q.value=e},ye=e=>{k.value=e},qe=()=>{N.value="REGISTRAR LOTE",he(),B.value=!0,O.toggleModal()},he=()=>{T.value="",R.value="",F.value="",W.value="",j.value="",H.value="",J.value="",f.value="",m.value="",g.value="",_.value="",d.value="",b.value="",q.value=""},we=e=>{N.value="EDITAR LOTE",B.value=!1,Z.value=e._id,T.value=e.name,R.value=e.areasize,F.value=e.lotestate,W.value=e.soildstate,j.value=e.classlot,H.value=e.sowingdensity,J.value=e.description,f.value=e.name,m.value=e.areasize,g.value=e.lotestate,_.value=e.soildstate,d.value=e.classlot,b.value=e.sowingdensity,q.value=e.description,O.toggleModal()},h=(e,l)=>{ie.notify({type:e,message:l,position:"top"})},x=async()=>{V.value=[],C.value=[],v.value=!0;try{const{lots:e}=await X(S.value);let l=1,y=1;e.forEach(r=>{r.status=r.status?"Inactivo":"Activo",r.status=="Activo"?(r.id=l++,V.value.push(r)):(r.id=y++,C.value.push(r)),r.description=r.description.trim()==""?"No registra":r.description}),v.value=!1}catch{v.value=!1,h("negative","Ocurrió un error")}};async function Se(){L.value=!0;const{lots:e}=await X(S.value),l=e.find(y=>y.name==k.value)._id;try{await We({name:f.value,areasize:m.value,lotestate:g.value,soildstate:_.value,classlot:d.value,fatherlot:l,sowingdensity:b.value,description:q.value},S.value),L.value=!1,h("positive","Lote registrado correctamente"),O.toggleModal(),V.value=[],x()}catch{L.value=!1,h("negative","Ocurrió un error, por favor verifique los datos")}}async function Ve(){const{lots:e}=await X(S.value),l=e.find(y=>y.name==k.value)._id;try{await je({id:Z.value,name:f.value,areasize:m.value,lotestate:g.value,soildstate:_.value,classlot:d.value,fatherlot:l,sowingdensity:b.value,description:q.value},S.value),L.value=!1,h("positive","Lote actualizado correctamente"),O.toggleModal(),V.value=[],x()}catch(y){L.value=!1,console.log(y),h("negative","Ocurrió un error, por favor verifique los datos")}}async function Le(e){v.value=!0;try{await He(e,S.value),h("positive","Eps activada correctamente"),v.value=!1,V.value=[],C.value=[],x()}catch{v.value=!1,h("negative","Ocurrió un error")}}async function ze(e){try{await Je(e,S.value),v.value=!1,h("positive","Eps desactivada correctamente"),V.value=[],C.value=[],x()}catch{v.value=!1,h("negative","Ocurrió un error")}}const S=ne(()=>de.idSelected);return Ue(S,()=>{x()}),Me(()=>{x()}),(e,l)=>{const y=i("q-separator"),r=i("q-tab"),ke=i("q-tabs"),ee=i("q-icon"),ae=i("q-input"),G=i("q-tooltip"),P=i("q-btn"),le=i("q-btn-group"),te=i("q-table"),oe=i("q-tab-panel"),xe=i("q-tab-panels"),Ie=i("q-card"),Oe=i("q-spinner-ios");return I(),ue(Be,null,[u("div",Pe,[u("div",Qe,[u("i",{class:"icon icon-backRoute q-pt-lg",onClick:l[0]||(l[0]=a=>e.$router.back())}),Xe]),t(y,{class:"separator"}),u("div",Ye,[t(Ge,{onOnClick:qe,label:"Crear nuevo lote"}),u("div",Ze,[t(Ie,null,{default:n(()=>[t(ke,{modelValue:o(w),"onUpdate:modelValue":l[1]||(l[1]=a=>c(w)?w.value=a:w=a),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:n(()=>[t(r,{name:"active",label:"Activos"}),t(r,{name:"inactive",label:"Inactivos"})]),_:1},8,["modelValue"]),t(y),t(xe,{modelValue:o(w),"onUpdate:modelValue":l[4]||(l[4]=a=>c(w)?w.value=a:w=a),animated:""},{default:n(()=>[t(oe,{name:"active"},{default:n(()=>[t(te,{flat:"",bordered:"",title:"Lotes","row-key":"name",rows:V.value,columns:$.value,filter:o(p),loading:v.value,"rows-per-page-options":[5,10,20]},{"top-right":n(()=>[t(ae,{borderless:"",dense:"",debounce:"300",modelValue:o(p),"onUpdate:modelValue":l[2]||(l[2]=a=>c(p)?p.value=a:p=a),placeholder:"Search"},{append:n(()=>[t(ee,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":n(a=>[u("td",Ke,[t(le,{class:"full-width full-height",outline:"",square:""},{default:n(()=>[t(P,{icon:"edit_note","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:se=>we(a.row)},{default:n(()=>[t(G,{class:"bg-indigo",offset:[10,10]},{default:n(()=>[A(" Editar ")]),_:1})]),_:2},1032,["onClick"]),t(P,{icon:"highlight_off","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:se=>ze(a.row._id)},{default:n(()=>[t(G,{class:"bg-indigo",offset:[10,10]},{default:n(()=>[A(" Desactivar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1}),t(oe,{name:"inactive"},{default:n(()=>[t(te,{flat:"",bordered:"",title:"Lotes","row-key":"name",rows:C.value,columns:$.value,filter:o(p),loading:v.value,"rows-per-page-options":[5,10,20]},{"top-right":n(()=>[t(ae,{borderless:"",dense:"",debounce:"300",modelValue:o(p),"onUpdate:modelValue":l[3]||(l[3]=a=>c(p)?p.value=a:p=a),placeholder:"Search"},{append:n(()=>[t(ee,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":n(a=>[u("td",$e,[t(le,{class:"full-width full-height",outline:"",square:""},{default:n(()=>[t(P,{"text-color":"blue-10",class:"col q-pa-none",onClick:se=>Le(a.row._id)},{default:n(()=>[ea,t(G,{class:"bg-indigo",offset:[10,10]},{default:n(()=>[A(" Activar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),o(O).modalIsOpen?(I(),E(Ne,{key:0,class:"modal"},{default:n(()=>[u("div",aa,[u("h6",la,Te(N.value),1),u("div",ta,[u("div",oa,[t(U,{class:"q-pb-xs",label:"Nombre",required:!0,type:"text",ruless:z,value:o(T),modelValue:o(f),"onUpdate:modelValue":l[5]||(l[5]=a=>c(f)?f.value=a:f=a),onOnWrite:ve},null,8,["value","modelValue"]),t(U,{class:"q-pb-xs",label:"Tamaño",type:"number",required:!0,ruless:z,value:o(R),modelValue:o(m),"onUpdate:modelValue":l[6]||(l[6]=a=>c(m)?m.value=a:m=a),onOnWrite:pe},null,8,["value","modelValue"]),t(M,{class:"q-pb-lg",label:"Estado del lote",type:"lotState",required:!0,ruless:z,value:o(F),modelValue:o(g),"onUpdate:modelValue":l[7]||(l[7]=a=>c(g)?g.value=a:g=a),onOnSelect:fe},null,8,["value","modelValue"]),t(M,{class:"q-pb-lg",label:"Estado del suelo",type:"soildState",required:!0,ruless:z,value:o(W),modelValue:o(_),"onUpdate:modelValue":l[8]||(l[8]=a=>c(_)?_.value=a:_=a),onOnSelect:me},null,8,["value","modelValue"]),t(M,{class:"q-pb-lg",label:"Clase",type:"typeLot",required:!0,ruless:z,value:o(j),modelValue:o(d),"onUpdate:modelValue":l[9]||(l[9]=a=>c(d)?d.value=a:d=a),onOnSelect:ge},null,8,["value","modelValue"]),o(d)=="HIJO"||o(d)=="PADRE-HIJO"?(I(),E(M,{key:0,class:"q-pb-lg",label:"Lote padre",type:"fatherLot",required:!0,ruless:z,value:o(ce),modelValue:o(k),"onUpdate:modelValue":l[10]||(l[10]=a=>c(k)?k.value=a:k=a),onOnSelect:ye},null,8,["value","modelValue"])):Q("",!0),t(U,{class:"q-pb-xs",label:"Densidad de siembra",type:"number",required:!0,ruless:z,value:o(H),modelValue:o(b),"onUpdate:modelValue":l[11]||(l[11]=a=>c(b)?b.value=a:b=a),onOnWrite:_e},null,8,["value","modelValue"]),t(U,{class:"q-pb-xs",label:"Descripción",type:"text",required:!1,value:o(J),modelValue:o(q),"onUpdate:modelValue":l[12]||(l[12]=a=>c(q)?q.value=a:q=a),onOnWrite:be},null,8,["value","modelValue"]),sa,u("div",na,[B.value?(I(),E(re,{key:0,disable:o(K),onOnClick:Se},null,8,["disable"])):(I(),E(re,{key:1,disable:o(K),onOnClick:Ve},null,8,["disable"]))]),L.value?(I(),ue("div",ua,[t(Oe,{color:"primary",size:"2.5em"})])):Q("",!0)])])])]),_:1})):Q("",!0)],64)}}},ca=Ce(ra,[["__scopeId","data-v-dcf06947"]]);export{ca as default};
