import{l as z,s as O,_ as me,m as be,q as he,g as r,v as ye,f as Y,x as qe,y as we,r as v,o as C,c as Z,a as i,d as a,w as n,h as c,i as F,M as Se,j as ee,F as ke,D as $,z as E,A as I,t as xe,B as te,E as Ee,C as ae,p as Ve,e as Ae}from"./index-751a0b5d.js";import{B as Ce}from"./ButtonAdd-426bdcc1.js";const Ie=async s=>{try{const d=z(),{data:o}=await O.get("/maintenance/stage",{headers:{token:d,farm:s}});return o}catch(d){return d}},ze=async(s,d)=>{try{const o=z(),{data:p}=await O.post("/maintenance/stage/register",{name:s.name,lot:s.lot,description:s.description},{headers:{token:o,farm:d}});return p}catch(o){return o}},Oe=async(s,d)=>{try{const o=z(),{data:p}=await O.put(`/maintenance/stage/update/${s.id}`,{name:s.name,lot:s.lot,description:s.description},{headers:{token:o,farm:d}});return p}catch(o){return o}},De=async(s,d)=>{try{const o=z(),{data:p}=await O.put(`/maintenance/stage/inactive/${s}`,{},{headers:{token:o,farm:d}});return p}catch(o){return o}},Me=async(s,d)=>{try{const o=z(),{data:p}=await O.put(`/maintenance/stage/active/${s}`,{},{headers:{token:o,farm:d}});return p}catch(o){return o}};const j=s=>(Ve("data-v-4c57e9d8"),s=s(),Ae(),s),Ne={class:"q-py-md table-container"},Be={class:"row"},Te=j(()=>i("h6",{class:"title q-my-lg"},"ETAPAS",-1)),Re={class:"container-content"},Le={class:"container-table q-mt-md q-pa-md",rounded:""},Ue={class:"accions-td"},Fe={class:"accions-td"},$e=j(()=>i("i",{class:"icon icon-check"},null,-1)),je={class:"q-my-md text-center"},Pe={class:"row q-px-xl"},We={class:"col-12"},Ge=j(()=>i("span",{class:"text-required q-pb-sm"},[I("Todos los campos con "),i("span",{class:"text-red"},"*"),I(" son obligatorios")],-1)),Qe={class:"row justify-center"},He={key:0,class:"spinner"},Je={__name:"Stages",setup(s){const d=be(),o=he(),p=r(""),f=r(!1),N=r(!0),S=r([]),V=r([]),P=r(),oe=ye(),q=r(!1),W=Y(()=>_.value==""?!0:q.value==!0),G=[e=>!!e||"Este campo es requerido"];let m=r(""),w=r("active"),_=r(""),g=r(""),b=r(""),B=r(""),T=r(""),R=r("");const Q=r([{name:"id",label:"#",field:"id",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"name",label:"Nombre",field:"name",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"lot",label:"Lote",field:"lot",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"description",label:"Descripción",field:"description",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Acciones",label:"Acciones",field:"acciones",align:"center",sortable:!0,headerStyle:"font-size: var(--font-medium); font-weight: bold;",style:"font-size: var(--font-medium);"}]),le=e=>{_.value=e},ne=e=>{g.value=e},se=e=>{b.value=e},re=()=>{p.value="REGISTRAR ETAPA",ce(),N.value=!0,o.toggleModal()},ce=()=>{B.value="",T.value="",R.value="",_.value="",g.value="",b.value=""},ie=e=>{p.value="EDITAR ETAPA",N.value=!1,P.value=e._id,B.value=e.name,_.value=e.name,T.value=e.description,b.value=e.description,R.value=e.lot,g.value=e.lot,o.toggleModal()},h=(e,t)=>{d.notify({type:e,message:t,position:"top"})},k=async()=>{S.value=[],V.value=[],f.value=!0;try{const{stages:e}=await Ie(y.value),{lots:t}=await $(y.value);let D=1,M=1;e.forEach(u=>{u.status=u.status?"Inactivo":"Activo";let x=u.lot;t.forEach(A=>{A._id==x&&(x=A.name)}),u.lot=x,u.status=="Activo"?(u.id=D++,S.value.push(u)):(u.id=M++,V.value.push(u)),u.description=u.description.trim()==""?"No registra":u.description}),f.value=!1}catch{f.value=!1,h("negative","Ocurrió un error")}};async function ue(){q.value=!0;const{lots:e}=await $(y.value);e.forEach(t=>{t.name==g.value&&(g.value=t._id)});try{await ze({name:_.value,lot:g.value,description:b.value},y.value),q.value=!1,h("positive","Etapa registrada correctamente"),o.toggleModal(),S.value=[],k()}catch{q.value=!1,h("negative","Ocurrió un error, por favor verifique los datos")}}async function de(){q.value=!0;const{lots:e}=await $(y.value);e.forEach(t=>{t.name==g.value&&(g.value=t._id)});try{await Oe({id:P.value,name:_.value,lot:g.value,description:b.value},y.value),q.value=!1,h("positive","Etapa actualizada correctamente"),o.toggleModal(),S.value=[],k()}catch{q.value=!1,h("negative","Ocurrió un error, por favor verifique los datos")}_.value="",g.value="",b.value=""}async function ve(e){f.value=!0;try{const t=await Me(e,y.value);h("positive","Etapa activada correctamente"),f.value=!1,S.value=[],V.value=[],k()}catch{f.value=!1,h("negative","Ocurrió un error")}}async function pe(e){f.value=!1;try{const t=await De(e,y.value);f.value=!1,h("positive","Etapa desactivada correctamente"),S.value=[],V.value=[],k()}catch{f.value=!1,h("negative","Ocurrió un error")}}const y=Y(()=>oe.idSelected);return qe(y,()=>{k()}),we(()=>{k()}),(e,t)=>{const D=v("q-separator"),M=v("q-tab"),u=v("q-tabs"),x=v("q-icon"),A=v("q-input"),L=v("q-tooltip"),U=v("q-btn"),H=v("q-btn-group"),J=v("q-table"),K=v("q-tab-panel"),fe=v("q-tab-panels"),_e=v("q-card"),ge=v("q-spinner-ios");return C(),Z(ke,null,[i("div",Ne,[i("div",Be,[i("i",{class:"icon icon-backRoute q-pt-lg",onClick:t[0]||(t[0]=l=>e.$router.back())}),Te]),a(D,{class:"separator"}),i("div",Re,[a(Ce,{onOnClick:re,label:"Crear nueva etapa"}),i("div",Le,[a(_e,null,{default:n(()=>[a(u,{modelValue:c(w),"onUpdate:modelValue":t[1]||(t[1]=l=>E(w)?w.value=l:w=l),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:n(()=>[a(M,{name:"active",label:"Activos"}),a(M,{name:"inactive",label:"Inactivos"})]),_:1},8,["modelValue"]),a(D),a(fe,{modelValue:c(w),"onUpdate:modelValue":t[4]||(t[4]=l=>E(w)?w.value=l:w=l),animated:""},{default:n(()=>[a(K,{name:"active"},{default:n(()=>[a(J,{flat:"",bordered:"",title:"Etapas","row-key":"name",rows:S.value,columns:Q.value,filter:c(m),loading:f.value,"rows-per-page-options":[5,10,20]},{"top-right":n(()=>[a(A,{borderless:"",dense:"",debounce:"300",modelValue:c(m),"onUpdate:modelValue":t[2]||(t[2]=l=>E(m)?m.value=l:m=l),placeholder:"Search"},{append:n(()=>[a(x,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":n(l=>[i("td",Ue,[a(H,{class:"full-width full-height",outline:"",square:""},{default:n(()=>[a(U,{icon:"edit_note","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:X=>ie(l.row)},{default:n(()=>[a(L,{class:"bg-indigo",offset:[10,10]},{default:n(()=>[I(" Editar ")]),_:1})]),_:2},1032,["onClick"]),a(U,{icon:"highlight_off","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:X=>pe(l.row._id)},{default:n(()=>[a(L,{class:"bg-indigo",offset:[10,10]},{default:n(()=>[I(" Desactivar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1}),a(K,{name:"inactive"},{default:n(()=>[a(J,{flat:"",bordered:"",title:"Etapas","row-key":"name",rows:V.value,columns:Q.value,filter:c(m),loading:f.value,"rows-per-page-options":[5,10,20]},{"top-right":n(()=>[a(A,{borderless:"",dense:"",debounce:"300",modelValue:c(m),"onUpdate:modelValue":t[3]||(t[3]=l=>E(m)?m.value=l:m=l),placeholder:"Search"},{append:n(()=>[a(x,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":n(l=>[i("td",Fe,[a(H,{class:"full-width full-height",outline:"",square:""},{default:n(()=>[a(U,{"text-color":"blue-10",class:"col q-pa-none",onClick:X=>ve(l.row._id)},{default:n(()=>[$e,a(L,{class:"bg-indigo",offset:[10,10]},{default:n(()=>[I(" Activar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),c(o).modalIsOpen?(C(),F(Se,{key:0},{default:n(()=>[i("h6",je,xe(p.value),1),i("div",Pe,[i("div",We,[a(te,{class:"q-pb-xs",label:"Nombre",required:!0,type:"text",ruless:G,value:c(B),modelValue:c(_),"onUpdate:modelValue":t[5]||(t[5]=l=>E(_)?_.value=l:_=l),onOnWrite:le},null,8,["value","modelValue"]),a(Ee,{class:"q-pb-lg",type:"lots",label:"Lote","v-model":c(g),required:!0,ruless:G,value:c(R),onOnSelect:ne},null,8,["v-model","value"]),a(te,{class:"q-pb-xs",label:"Descripción",type:"text",required:!1,value:c(T),modelValue:c(b),"onUpdate:modelValue":t[6]||(t[6]=l=>E(b)?b.value=l:b=l),onOnWrite:se},null,8,["value","modelValue"]),Ge,i("div",Qe,[N.value?(C(),F(ae,{key:0,disable:c(W),onOnClick:ue},null,8,["disable"])):(C(),F(ae,{key:1,disable:c(W),onOnClick:de},null,8,["disable"]))]),q.value?(C(),Z("div",He,[a(ge,{color:"primary",size:"2.5em"})])):ee("",!0)])])]),_:1})):ee("",!0)],64)}}},Ye=me(Je,[["__scopeId","data-v-4c57e9d8"]]);export{Ye as default};
