import{_ as Ce,f as Ae,y as Ee,g as s,z as De,h as re,A as Ue,C as Me,r as i,o as x,c as ie,a as u,d as t,w as n,i as o,q as M,M as Ne,l as Y,F as Be,H as Z,j as c,m as D,t as Te,k as N,G as B,B as de,p as Re,e as Fe,a6 as We,a7 as je,a8 as He,a9 as Ge}from"./index-21ef78fb.js";import{B as Je}from"./ButtonAdd-adf1e21d.js";const $=U=>(Re("data-v-8c2e138f"),U=U(),Fe(),U),Pe={class:"q-py-md table-container"},Qe={class:"row"},Ke=$(()=>u("h6",{class:"title q-my-lg"},"LOTES",-1)),Xe={class:"container-content"},Ye={class:"container-table q-mt-md q-pa-md",rounded:""},Ze={class:"accions-td"},$e={class:"accions-td"},ea=$(()=>u("i",{class:"icon icon-check"},null,-1)),aa={class:"modal-lots"},la={class:"q-my-md text-center"},ta={class:"row q-px-xl"},oa={class:"col-12"},sa=$(()=>u("span",{class:"text-required q-pb-sm"},[D("Todos los campos con "),u("span",{class:"text-red"},"*"),D(" son obligatorios")],-1)),na={class:"row justify-center"},ua={key:1,class:"spinner"},ra={__name:"Lots",setup(U){const ce=Ae(),O=Ee(),T=s(""),v=s(!1),R=s(!0),L=s([]),C=s([]),ee=s(),ve=De(),z=s(!1),ae=re(()=>(p.value,m.value,g.value,_.value,d.value,b.value?z.value==!0:!0)),k=[e=>!!e||"Este campo es requerido"];let f=s(""),S=s("active"),p=s(""),m=s(""),g=s(""),_=s(""),d=s(""),b=s(""),q=s(""),h=s(""),F=s(""),W=s(""),j=s(""),H=s(""),G=s(""),J=s(""),P=s(""),Q=s("");const le=s([{name:"id",label:"#",field:"id",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"name",label:"Nombre",field:"name",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"areasize",label:"Tamaño",field:"areasize",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"soildstate",label:"Estado del suelo",field:"soildstate",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"classlot",label:"Clase",field:"classlote",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"fatherlot",label:"Lote padre",field:"fatherlot",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"sowingdensity",label:"Densidad de siembra",field:"sowingdensity",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Acciones",label:"Acciones",field:"acciones",align:"center",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"}]),fe=e=>{p.value=e},pe=e=>{m.value=e},me=e=>{g.value=e},ge=e=>{_.value=e},_e=e=>{d.value=e},be=e=>{b.value=e},ye=e=>{q.value=e},qe=e=>{h.value=e},he=()=>{T.value="REGISTRAR LOTE",we(),R.value=!0,O.toggleModal()},we=()=>{F.value="",W.value="",j.value="",H.value="",G.value="",J.value="",P.value="",Q.value="",p.value="",m.value="",g.value="",_.value="",d.value="",b.value="",q.value="",h.value=""},Se=e=>{T.value="EDITAR LOTE",R.value=!1,ee.value=e._id,F.value=e.name,W.value=e.areasize,j.value=e.lotestate,H.value=e.soildstate,G.value=e.classlote,J.value=e.sowingdensity,P.value=e.description,Q.value=e.fatherlot,h.value=e.fatherlot,p.value=e.name,m.value=e.areasize,g.value=e.lotestate,_.value=e.soildstate,d.value=e.classlote,b.value=e.sowingdensity,q.value=e.description,O.toggleModal()},w=(e,l)=>{ce.notify({type:e,message:l,position:"top"})},I=async()=>{L.value=[],C.value=[],v.value=!0;try{const{lots:e}=await Z(V.value);let l=1,y=1;e.forEach(r=>{r.status=r.status?"Inactivo":"Activo";let A=r.fatherlot;e.forEach(E=>{E._id==A&&(A=E.name)}),r.fatherlot=A,r.status=="Activo"?(r.id=l++,L.value.push(r)):(r.id=y++,C.value.push(r)),r.description=r.description.trim()==""?"No registra":r.description}),v.value=!1}catch{v.value=!1,w("negative","Ocurrió un error")}};async function Ve(){z.value=!0;const{lots:e}=await Z(V.value),l=e.find(y=>y.name==h.value)._id;try{await We({name:p.value,areasize:m.value,lotestate:g.value,soildstate:_.value,classlot:d.value,fatherlot:l,sowingdensity:b.value,description:q.value},V.value),z.value=!1,w("positive","Lote registrado correctamente"),O.toggleModal(),L.value=[],I()}catch{z.value=!1,w("negative","Ocurrió un error, por favor verifique los datos")}}async function Le(){const{lots:e}=await Z(V.value),l=e.find(y=>y.name==h.value)._id;try{await je({id:ee.value,name:p.value,areasize:m.value,lotestate:g.value,soildstate:_.value,classlot:d.value,fatherlot:l,sowingdensity:b.value,description:q.value},V.value),z.value=!1,w("positive","Lote actualizado correctamente"),O.toggleModal(),L.value=[],I()}catch(y){z.value=!1,console.log(y),w("negative","Ocurrió un error, por favor verifique los datos")}}async function ze(e){v.value=!0;try{await He(e,V.value),w("positive","Eps activada correctamente"),v.value=!1,L.value=[],C.value=[],I()}catch{v.value=!1,w("negative","Ocurrió un error")}}async function ke(e){try{await Ge(e,V.value),v.value=!1,w("positive","Eps desactivada correctamente"),L.value=[],C.value=[],I()}catch{v.value=!1,w("negative","Ocurrió un error")}}const V=re(()=>ve.idSelected);return Ue(V,()=>{I()}),Me(()=>{I()}),(e,l)=>{const y=i("q-separator"),r=i("q-tab"),A=i("q-tabs"),E=i("q-icon"),te=i("q-input"),K=i("q-tooltip"),X=i("q-btn"),oe=i("q-btn-group"),se=i("q-table"),ne=i("q-tab-panel"),Ie=i("q-tab-panels"),xe=i("q-card"),Oe=i("q-spinner-ios");return x(),ie(Be,null,[u("div",Pe,[u("div",Qe,[u("i",{class:"icon icon-backRoute q-pt-lg",onClick:l[0]||(l[0]=a=>e.$router.back())}),Ke]),t(y,{class:"separator"}),u("div",Xe,[t(Je,{onOnClick:he,label:"Crear nuevo lote"}),u("div",Ye,[t(xe,null,{default:n(()=>[t(A,{modelValue:o(S),"onUpdate:modelValue":l[1]||(l[1]=a=>c(S)?S.value=a:S=a),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:n(()=>[t(r,{name:"active",label:"Activos"}),t(r,{name:"inactive",label:"Inactivos"})]),_:1},8,["modelValue"]),t(y),t(Ie,{modelValue:o(S),"onUpdate:modelValue":l[4]||(l[4]=a=>c(S)?S.value=a:S=a),animated:""},{default:n(()=>[t(ne,{name:"active"},{default:n(()=>[t(se,{flat:"",bordered:"",title:"Lotes","row-key":"name",rows:L.value,columns:le.value,filter:o(f),loading:v.value,"rows-per-page-options":[5,10,20]},{"top-right":n(()=>[t(te,{borderless:"",dense:"",debounce:"300",modelValue:o(f),"onUpdate:modelValue":l[2]||(l[2]=a=>c(f)?f.value=a:f=a),placeholder:"Search"},{append:n(()=>[t(E,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":n(a=>[u("td",Ze,[t(oe,{class:"full-width full-height",outline:"",square:""},{default:n(()=>[t(X,{icon:"edit_note","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:ue=>Se(a.row)},{default:n(()=>[t(K,{class:"bg-indigo",offset:[10,10]},{default:n(()=>[D(" Editar ")]),_:1})]),_:2},1032,["onClick"]),t(X,{icon:"highlight_off","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:ue=>ke(a.row._id)},{default:n(()=>[t(K,{class:"bg-indigo",offset:[10,10]},{default:n(()=>[D(" Desactivar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1}),t(ne,{name:"inactive"},{default:n(()=>[t(se,{flat:"",bordered:"",title:"Lotes","row-key":"name",rows:C.value,columns:le.value,filter:o(f),loading:v.value,"rows-per-page-options":[5,10,20]},{"top-right":n(()=>[t(te,{borderless:"",dense:"",debounce:"300",modelValue:o(f),"onUpdate:modelValue":l[3]||(l[3]=a=>c(f)?f.value=a:f=a),placeholder:"Search"},{append:n(()=>[t(E,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":n(a=>[u("td",$e,[t(oe,{class:"full-width full-height",outline:"",square:""},{default:n(()=>[t(X,{"text-color":"blue-10",class:"col q-pa-none",onClick:ue=>ze(a.row._id)},{default:n(()=>[ea,t(K,{class:"bg-indigo",offset:[10,10]},{default:n(()=>[D(" Activar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),o(O).modalIsOpen?(x(),M(Ne,{key:0,class:"modal"},{default:n(()=>[u("div",aa,[u("h6",la,Te(T.value),1),u("div",ta,[u("div",oa,[t(N,{class:"q-pb-xs",label:"Nombre",required:!0,type:"text",ruless:k,value:o(F),modelValue:o(p),"onUpdate:modelValue":l[5]||(l[5]=a=>c(p)?p.value=a:p=a),onOnWrite:fe},null,8,["value","modelValue"]),t(N,{class:"q-pb-xs",label:"Tamaño",type:"number",required:!0,ruless:k,value:o(W),modelValue:o(m),"onUpdate:modelValue":l[6]||(l[6]=a=>c(m)?m.value=a:m=a),onOnWrite:pe},null,8,["value","modelValue"]),t(B,{class:"q-pb-lg",label:"Estado del lote",type:"lotState",required:!0,ruless:k,value:o(j),modelValue:o(g),"onUpdate:modelValue":l[7]||(l[7]=a=>c(g)?g.value=a:g=a),onOnSelect:me},null,8,["value","modelValue"]),t(B,{class:"q-pb-lg",label:"Estado del suelo",type:"soildState",required:!0,ruless:k,value:o(H),modelValue:o(_),"onUpdate:modelValue":l[8]||(l[8]=a=>c(_)?_.value=a:_=a),onOnSelect:ge},null,8,["value","modelValue"]),t(B,{class:"q-pb-lg",label:"Clase",type:"typeLot",required:!0,ruless:k,value:o(G),modelValue:o(d),"onUpdate:modelValue":l[9]||(l[9]=a=>c(d)?d.value=a:d=a),onOnSelect:_e},null,8,["value","modelValue"]),o(d)=="HIJO"||o(d)=="PADRE-HIJO"?(x(),M(B,{key:0,class:"q-pb-lg",label:"Lote padre",type:"fatherLot",required:!0,ruless:k,value:o(Q),modelValue:o(h),"onUpdate:modelValue":l[10]||(l[10]=a=>c(h)?h.value=a:h=a),onOnSelect:qe},null,8,["value","modelValue"])):Y("",!0),t(N,{class:"q-pb-xs",label:"Densidad de siembra",type:"number",required:!0,ruless:k,value:o(J),modelValue:o(b),"onUpdate:modelValue":l[11]||(l[11]=a=>c(b)?b.value=a:b=a),onOnWrite:be},null,8,["value","modelValue"]),t(N,{class:"q-pb-xs",label:"Descripción",type:"text",required:!1,value:o(P),modelValue:o(q),"onUpdate:modelValue":l[12]||(l[12]=a=>c(q)?q.value=a:q=a),onOnWrite:ye},null,8,["value","modelValue"]),sa,u("div",na,[R.value?(x(),M(de,{key:0,disable:o(ae),onOnClick:Ve},null,8,["disable"])):(x(),M(de,{key:1,disable:o(ae),onOnClick:Le},null,8,["disable"]))]),z.value?(x(),ie("div",ua,[t(Oe,{color:"primary",size:"2.5em"})])):Y("",!0)])])])]),_:1})):Y("",!0)],64)}}},ca=Ce(ra,[["__scopeId","data-v-8c2e138f"]]);export{ca as default};
