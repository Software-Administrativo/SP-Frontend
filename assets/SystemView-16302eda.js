import{g as Ee,u as Ie,p as ke,a as Ae,i as Oe}from"./index-5dd0a30a.js";import{B as De}from"./ButtonAdd-9b531d6c.js";import{_ as Re,f as xe,y as Ce,g as s,z as Te,h as le,A as ze,C as Ne,r as m,o as w,c as te,a as c,d as o,w as i,i as t,q as I,M as Pe,l as x,F as Le,j as v,t as Me,k as oe,E as H,ai as Be,B as se,p as Fe,e as We,m as ne,R as k}from"./index-f354315f.js";import{_ as je}from"./Email-7c878248.js";const Q=P=>(Fe("data-v-d5e9ede2"),P=P(),We(),P),Ge={class:"q-py-md table-container"},Xe=Q(()=>c("h6",{class:"title q-my-lg"},"ACCESO AL SISTEMA",-1)),He={class:"container-content"},Qe={class:"container-table q-mt-md q-pa-md",rounded:""},Je={class:"accions-td"},Ke={class:"accions-td"},Ye=Q(()=>c("i",{class:"icon icon-check"},null,-1)),Ze={class:"modalSystem"},$e={class:"q-my-md text-center"},ea={class:"row q-px-xl"},aa={class:"col-12"},la={class:"row justify-between"},ta=Q(()=>c("span",{class:"text-required q-py-sm"},[ne("Todos los campos con "),c("span",{class:"text-red"},"*"),ne(" son obligatorios")],-1)),oa={class:"row justify-center q-mt-sm"},sa={key:4,class:"spinner"},na={__name:"SystemView",setup(P){const re=xe(),z=Ce(),J=s(),L=s(""),p=s(!1),V=s(!1),M=s(!0),A=s([]),N=s([]),ue=Te();let B=s(""),F=s(""),W=s(""),O=s(""),j=s(""),G=s(""),f=s(""),_=s(""),g=s(""),h=s(""),y=s(""),b=s(""),U=s(""),S=s(""),E=s("active");const K=le(()=>!f.value||!_.value||!g.value||!y.value||!b.value||!U.value||!h.value?!0:V.value==!0),D=[e=>!!e||"Este campo es requerido"],Y=s([{name:"id",label:"#",field:"id",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Nombre",label:"Nombre",field:"name",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Tipo",label:"Tipo",field:"tpdocument",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Documento",label:"Documento",field:"numdocument",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"email",label:"Correo Electronico",field:"email",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"role",label:"Rol",field:"role",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Acciones",label:"Acciones",field:"acciones",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"}]),ie=e=>{f.value=e},ce=e=>{_.value=e},de=e=>{g.value=e},me=e=>{h.value=e},ve=e=>{y.value=e},pe=e=>{b.value=e},fe=e=>{U.value=e},_e=()=>{L.value="REGISTRAR ACCESO",ge(),M.value=!0,z.toggleModal()},ge=()=>{B.value="",F.value="",W.value="",O.value="",j.value="",G.value="",f.value="",_.value="",g.value="",y.value="",b.value="",U.value="",h.value=""},ye=e=>{L.value="EDITAR TIPO DE PAGO",M.value=!1,J.value=e._id,B.value=e.name,F.value=e.tpdocument,W.value=e.numdocument,O.value=e.role,j.value=e.farms,G.value=e.email,f.value=e.name,_.value=e.tpdocument,g.value=e.numdocument,y.value=e.role,b.value=e.email,z.toggleModal()},n=(e,l)=>{re.notify({type:e,message:l,position:"top"})};async function C(){A.value=[],N.value=[],p.value=!0;try{const e=await Ee(T.value);let l=1,q=1;e.forEach(r=>{r.status=r.status?"Inactivo":"Activo",r.status=="Activo"?(r.id=l++,A.value.push(r)):(r.id=q++,N.value.push(r))}),p.value=!1}catch{n("negative","Ocurrió un error al obtener los usuarios")}}async function be(){var q,r,R;V.value=!0;let e=h.value,l=[];e.forEach(u=>{l.push(u._id)});try{const u=await Ie({id:J.value,name:f.value,tpdocument:_.value,numdocument:g.value,role:y.value,farms:l,email:b.value,password:U.value},T.value);V.value=!1;let d=(R=(r=(q=u==null?void 0:u.response)==null?void 0:q.data)==null?void 0:r.errors[0])==null?void 0:R.msg;d==k.USEREXIST?n("negative","El usuario ya existe"):d==k.LENGTHPASSWORD?n("negative","La contraseña debe tener de 6 a 20 carácteres"):d==k.RULESPASSWORD?n("negative","La contraseña debe tener una letra mayúscula, una letra minúscula y un número"):d==k.EMAILEXIST?n("negative","El email ya esta registrado"):(n("positive","Tipo de pago actualizado correctamente"),z.toggleModal(),A.value=[],C())}catch{V.value=!1,n("negative","Ocurrió un error")}}async function Se(){var q,r,R;V.value=!0;let e=h.value,l=[];e.forEach(u=>{l.push(u._id)});try{const u=await ke({name:f.value,tpdocument:_.value,numdocument:g.value,role:y.value,farms:l,email:b.value,password:U.value},T.value);V.value=!1;let d=(R=(r=(q=u==null?void 0:u.response)==null?void 0:q.data)==null?void 0:r.errors[0])==null?void 0:R.msg;d==k.USEREXIST?n("negative","El usuario ya existe"):d==k.LENGTHPASSWORD?n("negative","La contraseña debe tener de 6 a 20 carácteres"):d==k.RULESPASSWORD?n("negative","La contraseña debe tener una letra mayúscula, una letra minúscula y un número"):d==k.EMAILEXIST?n("negative","El email ya esta registrado"):(z.toggleModal(),A.value=[],n("positive","Usuario registrado correctamente"),C())}catch{V.value=!1,n("negative","Ocurrió un error")}}async function qe(e){p.value=!0;try{await Ae(e,T.value),p.value=!1,n("positive","Usuario activado correctamente"),A.value=[],N.value=[],C()}catch{p.value=!1,n("negative","Ocurrió un error al activar el usuario")}}async function we(e){p.value=!0;try{await Oe(e,T.value),n("positive","Usuario desactivado correctamente"),p.value=!1,A.value=[],N.value=[],C()}catch{p.value=!1,n("negative","Ocurrió un error al desactivar el usuario")}}const T=le(()=>ue.idSelected);return ze(T,()=>{C()}),Ne(()=>{C()}),(e,l)=>{const q=m("q-separator"),r=m("q-tab"),R=m("q-tabs"),u=m("q-icon"),d=m("q-input"),X=m("q-btn"),Z=m("q-btn-group"),$=m("q-table"),ee=m("q-tab-panel"),he=m("q-tab-panels"),Ue=m("q-card"),Ve=m("q-spinner-ios");return w(),te(Le,null,[c("div",Ge,[Xe,o(q,{class:"separator"}),c("div",He,[o(De,{onOnClick:_e,label:"Crear nuevo usuario"}),c("div",Qe,[o(Ue,null,{default:i(()=>[o(R,{modelValue:t(E),"onUpdate:modelValue":l[0]||(l[0]=a=>v(E)?E.value=a:E=a),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:i(()=>[o(r,{name:"active",label:"Activos"}),o(r,{name:"inactive",label:"Inactivos"})]),_:1},8,["modelValue"]),o(q),o(he,{modelValue:t(E),"onUpdate:modelValue":l[3]||(l[3]=a=>v(E)?E.value=a:E=a),animated:""},{default:i(()=>[o(ee,{name:"active"},{default:i(()=>[o($,{flat:"",bordered:"",title:"Usuarios","row-key":"name",rows:A.value,columns:Y.value,filter:t(S),loading:p.value,"rows-per-page-options":[5,10,20]},{"top-right":i(()=>[o(d,{borderless:"",dense:"",debounce:"300",modelValue:t(S),"onUpdate:modelValue":l[1]||(l[1]=a=>v(S)?S.value=a:S=a),placeholder:"Buscar"},{append:i(()=>[o(u,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":i(a=>[c("td",Je,[o(Z,{class:"full-width full-height",outline:"",square:""},{default:i(()=>[o(X,{icon:"edit_note","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:ae=>ye(a.row)},null,8,["onClick"]),a.row.role=="ADMIN"?(w(),I(X,{key:0,icon:"highlight_off","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:ae=>we(a.row._id)},null,8,["onClick"])):x("",!0)]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1}),o(ee,{name:"inactive"},{default:i(()=>[o($,{flat:"",bordered:"",title:"Usuarios","row-key":"name",rows:N.value,columns:Y.value,filter:t(S),loading:p.value,"rows-per-page-options":[5,10,20]},{"top-right":i(()=>[o(d,{borderless:"",dense:"",debounce:"300",modelValue:t(S),"onUpdate:modelValue":l[2]||(l[2]=a=>v(S)?S.value=a:S=a),placeholder:"Buscar"},{append:i(()=>[o(u,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":i(a=>[c("td",Ke,[o(Z,{class:"full-width full-height",outline:"",square:""},{default:i(()=>[o(X,{"text-color":"blue-10",class:"col q-pa-none",onClick:ae=>qe(a.row._id)},{default:i(()=>[Ye]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),t(z).modalIsOpen?(w(),I(Pe,{key:0,class:"modal"},{default:i(()=>[c("div",Ze,[c("h6",$e,Me(L.value),1),c("div",ea,[c("div",aa,[o(oe,{label:"Nombre",type:"text",required:!0,ruless:D,value:t(B),modelValue:t(f),"onUpdate:modelValue":l[4]||(l[4]=a=>v(f)?f.value=a:f=a),onOnWrite:ie},null,8,["value","modelValue"]),c("div",la,[o(H,{class:"q-pb-xs q-mb-md",type:"documents",label:"Tipo de documento",required:!0,ruless:D,value:t(F),modelValue:t(_),"onUpdate:modelValue":l[5]||(l[5]=a=>v(_)?_.value=a:_=a),onOnSelect:ce},null,8,["value","modelValue"]),o(oe,{label:"Número documento",type:"number",required:!0,ruless:D,value:t(W),modelValue:t(g),"onUpdate:modelValue":l[6]||(l[6]=a=>v(g)?g.value=a:g=a),onOnWrite:de},null,8,["value","modelValue"])]),t(O)!="SUPER"?(w(),I(H,{key:0,class:"col-4 q-pb-xs q-mb-md",type:"roles",label:"Rol",required:!0,ruless:D,value:t(O),modelValue:t(y),"onUpdate:modelValue":l[7]||(l[7]=a=>v(y)?y.value=a:y=a),onOnSelect:ve},null,8,["value","modelValue"])):x("",!0),t(O)!="SUPER"?(w(),I(H,{key:1,class:"q-pb-xs q-mb-md",label:"Acceso",type:"multiFarms",required:!0,ruless:D,value:t(j),modelValue:t(h),"onUpdate:modelValue":l[8]||(l[8]=a=>v(h)?h.value=a:h=a),onOnSelect:me},null,8,["value","modelValue"])):x("",!0),t(O)!="SUPER"?(w(),I(je,{key:2,label:"Email",required:!0,ruless:D,value:t(G),modelValue:t(b),"onUpdate:modelValue":l[9]||(l[9]=a=>v(b)?b.value=a:b=a),onOnEmail:pe},null,8,["value","modelValue"])):x("",!0),t(O)!="SUPER"?(w(),I(Be,{key:3,label:"Contraseña",required:!0,ruless:D,modelValue:t(U),"onUpdate:modelValue":l[10]||(l[10]=a=>v(U)?U.value=a:U=a),onOnPassword:fe},null,8,["modelValue"])):x("",!0),ta,c("div",oa,[M.value?(w(),I(se,{key:0,disable:t(K),onOnClick:Se},null,8,["disable"])):(w(),I(se,{key:1,disable:t(K),onOnClick:be},null,8,["disable"]))]),V.value?(w(),te("div",sa,[o(Ve,{color:"primary",size:"2.5em"})])):x("",!0)])])])]),_:1})):x("",!0)],64)}}},da=Re(na,[["__scopeId","data-v-d5e9ede2"]]);export{da as default};
